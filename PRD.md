# PRD: 提示词优化平台 (Prompt Optimizer)

> 版本: v1.0 | 日期: 2026-02-15 | 状态: 初稿

---

## 1. 项目概述

### 1.1 背景

用户拥有大量语音对话数据（TXT 格式），需要通过 AI 提示词生成总结，并通过对比参考总结来评估和优化提示词质量。

### 1.2 目标

构建一个**提示词优化 CLI 工具**，支持：
- 多场景对话总结生成
- LLM-as-a-Judge 评估对比
- 提示词版本管理
- 为后续前端界面奠定基础

---

## 2. 功能清单

| # | 功能 | 描述 | 优先级 |
|---|------|------|--------|
| F1 | 场景自动识别 | 从对话内容自动识别会议类型 | P0 |
| F2 | 总结生成 | 使用提示词 + 对话数据生成总结 | P0 |
| F3 | 对比评估 | LLM-as-a-Judge 对比生成 vs 参考总结 | P0 |
| F4 | 自动评分 | 输出多维度评分 + 等级 | P0 |
| F5 | 优化建议 | 自动生成提示词改进建议 | P1 |
| F6 | 版本管理 | 提示词版本存档，支持下载 | P1 |
| F7 | 多模型选择 | 支持选择不同 LLM 进行优化 | P1 |
| F8 | Docker 部署 | 支持容器化部署 | P2 |

---

## 3. 场景定义

### 3.1 场景分类体系

```
meeting/
├── product/           # 产品类
│   ├── weekly        # 产品周会
│   ├── review        # 需求评审会
│   └── launch       # 产品发布会
├── marketing/        # 营销类
│   ├── weekly        # 营销周会
│   ├── campaign     # 推广策划会
│   ├── brand        # 品牌策略会
│   └── partnership  # 合作洽谈会
├── sales/            # 销售类
│   ├── meeting      # 销售会议
│   ├── negotiation  # 客户谈判
│   └── channel      # 渠道会议
├── strategy/         # 战略管理类
│   ├── strategy     # 战略会议
│   ├── management   # 管理层例会
│   └── review       # 复盘会
├── hr/               # 人事类
│   ├── interview    # 面试
│   ├── performance  # 绩效面谈
│   ├── exit         # 离职面谈
│   └── team         # 团队建设
├── rd/               # 研发类
│   ├── tech-review  # 技术评审会
│   ├── planning     # 排期会
│   └── incident     # 故障分析会
└── other/            # 其他
    ├── finance      # 财务会议
    └── legal        # 法务合规
```

### 3.2 场景识别算法

1. **关键词匹配** → 提取行业/岗位特征词
2. **规则判断** → 基于会议议程、角色词汇判断类型
3. **LLM 兜底** → 规则无法判断时，调用 LLM 推断场景

---

## 4. CLI 命令设计

### 4.1 命令结构

```bash
po <command> [options]
```

### 4.2 命令列表

#### 4.2.1 场景检测

```bash
po detect -d <对话数据.txt>
```

**输出:**
```json
{
  "detected": "product/weekly",
  "confidence": 0.85,
  "keywords": ["上周", "需求", "排期", "上线"]
}
```

#### 4.2.2 生成总结

```bash
po generate -d <对话数据.txt> -p <提示词.md> [-s <场景>] [-o <输出文件>]
```

**参数:**
| 参数 | 简写 | 必填 | 说明 |
|------|------|------|------|
| --data | -d | ✅ | 对话数据文件路径 (TXT) |
| --prompt | -p | ✅ | 提示词文件路径 (MD) |
| --scene | -s | - | 场景路径，如 product/weekly |
| --output | -o | - | 输出文件路径 |

**输出:**
```bash
✅ 总结已生成: outputs/product/weekly/2026-02-15-143022.md
```

#### 4.2.3 评估总结

```bash
po evaluate -g <生成总结.md> -r <参考总结.md> [-o <输出文件>]
```

**参数:**
| 参数 | 简写 | 必填 | 说明 |
|------|------|------|------|
| --generated | -g | ✅ | AI 生成的总结文件 |
| --reference | -r | ✅ | 参考总结文件 |
| --output | -o | - | 评估结果输出路径 |

**输出:**
```json
{
  "score": {
    "completeness": 85,
    "detail": 70,
    "thoroughness": 75,
    "word_count_diff": 60,
    "total": 73.5,
    "grade": "B"
  },
  "analysis": {
    "strengths": ["提取了核心需求", "包含时间线"],
    "weaknesses": ["缺少优先级", "细节不足"]
  },
  "suggestions": [
    "建议添加需求优先级字段",
    "建议补充负责人信息"
  ]
}
```

#### 4.2.4 优化提示词

```bash
po optimize -p <提示词.md> -m <模型> [-o <输出文件>]
```

**参数:**
| 参数 | 简写 | 必填 | 说明 |
|------|------|------|------|
| --prompt | -p | ✅ | 待优化的提示词 |
| --model | -m | - | 模型选择 (default: gpt-4) |
| --output | -o | - | 输出路径 |

**支持的模型:**
- gpt-4
- gpt-4o
- claude-3-opus
- claude-3-sonnet

**输出:**
```bash
✅ 优化建议已生成: prompts/product/weekly/v2_suggestion.md
# 用户可手动采纳建议并保存为新版本
```

#### 4.2.5 版本管理

```bash
# 列出提示词版本
po versions -p <提示词.md>

# 保存新版本
po version save -p <提示词.md> -m "添加优先级字段"

# 下载指定版本
po version download -p <提示词.md> -v <版本号> -o <输出路径>
```

#### 4.2.6 初始化项目

```bash
po init                    # 在当前目录初始化
po init -p <项目名称>      # 创建项目目录
```

---

## 5. 数据结构

### 5.1 目录结构

```
prompt-optimizer/
├── .po/                           # 项目配置
│   └── config.json                # 配置文件
├── prompts/                       # 提示词库
│   ├── _meta/
│   │   └── index.json            # 提示词索引
│   ├── product/
│   │   ├── weekly/
│   │   │   ├── default.md        # 当前生效版本
│   │   │   ├── v1.md             # 版本 1
│   │   │   ├── v2.md             # 版本 2
│   │   │   └── v2_suggestion.md  # 优化建议（待采纳）
│   │   ├── review/
│   │   └── launch/
│   ├── marketing/
│   ├── sales/
│   ├── strategy/
│   ├── hr/
│   ├── rd/
│   └── other/
├── outputs/                       # 生成的总结
│   ├── product/weekly/...
│   └── ...
├── evaluations/                  # 评估结果
│   └── 2026-02-15/
│       └── eval_xxx.json
├── dialogue/                      # 对话数据（可选存档）
└── po.config.js                  # CLI 配置
```

### 5.2 提示词索引格式 (.po/_meta/index.json)

```json
{
  "scenes": {
    "product/weekly": {
      "current_version": "v2",
      "versions": [
        {"id": "v1", "created_at": "2026-01-01", "note": "初始版本"},
        {"id": "v2", "created_at": "2026-02-15", "note": "添加优先级字段"}
      ]
    }
  }
}
```

---

## 6. 评估体系 (LLM-as-a-Judge)

### 6.1 评估维度

| 维度 | 权重 | 说明 |
|------|------|------|
| 信息完整度 | 30% | 是否提取了所有重要信息 |
| 详细程度 | 25% | 细节是否充分展开 |
| 细致程度 | 25% | 是否有遗漏的关键点 |
| 字数差异 | 20% | 与参考总结的字数差距 |

### 6.2 评分等级

| 等级 | 分数区间 | 说明 |
|------|----------|------|
| S | 90-100 | 优秀，无需修改 |
| A | 80-89 | 良好，小幅优化即可 |
| B | 70-79 | 中等，建议优化 |
| C | 60-69 | 及格，需要较大改进 |
| D | <60 | 不及格，需要重新生成 |

### 6.3 评估 Prompt 模板

```markdown
你是一个专业的提示词评估专家。请对比以下两篇总结，从四个维度进行评估。

## 生成总结
{{generated_summary}}

## 参考总结
{{reference_summary}}

## 评估维度
1. 信息完整度 (0-100): 是否提取了所有重要信息？
2. 详细程度 (0-100): 细节是否充分展开？
3. 细致程度 (0-100): 是否有遗漏的关键点？
4. 字数差异 (0-100): 与参考总结的字数差距是否合理？

## 输出格式
请以 JSON 格式输出：
{
  "completeness": 数字,
  "detail": 数字,
  "thoroughness": 数字,
  "word_count_diff": 数字,
  "total": 数字,
  "grade": "S|A|B|C|D",
  "strengths": ["优点1", "优点2"],
  "weaknesses": ["不足1", "不足2"],
  "suggestions": ["建议1", "建议2"]
}
```

---

## 7. 场景识别规则

### 7.1 关键词映射

| 场景 | 关键词 |
|------|--------|
| 产品周会 | 上周、完成、需求、排期、上线、迭代 |
| 需求评审 | 需求、评审、PRD、优先级、Story |
| 产品发布会 | 发布、新功能、亮点、演示 |
| 营销周会 | 投放、转化、曝光、活动、GMV |
| 推广策划 | 策划、方案、创意、目标人群 |
| 品牌策略 | 品牌、定位、差异化、价值观 |
| 销售会议 | 业绩、目标、客户、签约、跟进 |
| 客户谈判 | 报价、合同、让步、签约 |
| 战略会议 | 战略、三年规划、愿景、竞争 |
| 复盘会 | 复盘、总结、经验、教训 |
| 面试 | 自我介绍、项目经历、离职原因、优势 |
| 技术评审 | 架构、技术方案、可行性、风险 |

### 7.2 识别流程

```
对话文本
    ↓
分词 + 关键词提取
    ↓
匹配场景规则
    ↓
置信度计算
    ↓
[置信度 > 0.7] → 输出场景
    ↓
[置信度 ≤ 0.7] → LLM 判断
```

---

## 8. 技术实现

### 8.1 技术栈

- **运行时**: Node.js 18+
- **CLI 框架**: Commander.js
- **存储**: 本地文件系统 (MD + JSON)
- **AI**: OpenAI / Anthropic API
- **部署**: Docker

### 8.2 Docker 支持

```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install -g prompt-optimizer
COPY .po/ .po/
CMD ["po", "--help"]
```

---

## 9. 用户流程

```
┌─────────────────┐
│  1. 上传对话    │
│  (TXT 文件)     │
└────────┬────────┘
         ↓
┌─────────────────┐
│  2. 场景自动识别 │ ← po detect
└────────┬────────┘
         ↓
┌─────────────────┐
│  3. 生成总结    │ ← po generate
│  (使用提示词)   │
└────────┬────────┘
         ↓
┌─────────────────┐
│  4. 上传参考    │
│  总结 (MD)      │
└────────┬────────┘
         ↓
┌─────────────────┐
│  5. 对比评估    │ ← po evaluate
│  (LLM-as-Judge) │
└────────┬────────┘
         ↓
┌─────────────────┐
│  6. 查看评分    │
│  + 改进建议     │
└────────┬────────┘
         ↓
┌─────────────────┐
│  7. 手动编辑   │
│  提示词 (可选) │
└────────┬────────┘
         ↓
┌─────────────────┐
│  8. 保存新版本  │ ← po version save
└─────────────────┘
```

---

## 10. 待确认事项

- [ ] 评估 prompt 的具体写法是否需要调整
- [ ] 是否需要支持自定义评估维度
- [ ] 模型选择是否需要配置 API Key

---

## 11. 下一步计划

1. ✅ 确认 PRD 内容
2. ⬜ 初始化 Node.js 项目
3. ⬜ 实现场景识别模块
4. ⬜ 实现总结生成命令
5. ⬜ 实现评估命令
6. ⬜ 实现版本管理
7. ⬜ Docker 打包
8. ⬜ 前端界面开发（后续）

---

**文档版本历史**

| 版本 | 日期 | 修改内容 |
|------|------|----------|
| v1.0 | 2026-02-15 | 初稿 |
